#!/bin/bash

if [[ -z "$1" ]]; then
  echo "syntax:  tsh-mail [start stop restart update]"
  exit 1
fi

if [[ "$1" == "start" || "$1" == "restart" ]]; then
  echo "Starting TSH Mail Services . . ."
  systemctl start tsh-mail.service
elif [[ "$1" == "update" ]]; then
  echo "Checking for an existing instance of TSH Mail Services . . . "
  id=$(docker ps | grep tsh-mail | awk '{print $1}')
  if [[ ${#id} != 0 ]]; then
    echo "found.  stopping. "
    systemctl stop tsh-mail.service
  fi
  echo "Updating TSH Mail Services . . . "
  echo "Pulling tofoursquare/tsh-mail:latest . . . "
  docker pull tofoursquare/tsh-mail:latest
  echo "Starting the newest version of TSH Mail Services . . . "
  systemctl start tsh-mail.service
elif [[ "$1" == "stop" ]]; then
  echo "Stopping TSH Mail Services . . ."
  id=$(docker ps | grep tsh-mail | awk '{print $1}')
  if [[ ${#id} != 0 ]]; then
    systemctl stop tsh-mail.service
  else
    echo "tsh-mail is not currently running. "
  fi
else
  echo "error:  the only valid options are start, stop, restart and update."
fi
